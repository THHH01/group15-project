{
  "info": {
    "name": "Avatar Upload v·ªõi Sharp",
    "_postman_id": "avatar-upload-001",
    "description": "Collection ƒë·ªÉ test upload avatar v·ªõi Sharp resize",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. ƒêƒÉng nh·∫≠p ƒë·ªÉ l·∫•y token",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const jsonData = pm.response.json();",
              "    pm.environment.set('accessToken', jsonData.accessToken);",
              "    pm.environment.set('refreshToken', jsonData.refreshToken);",
              "    pm.environment.set('userId', jsonData.nguoiDung.id);",
              "    pm.test('‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng', () => {",
              "        pm.expect(jsonData.accessToken).to.be.a('string');",
              "    });",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [{"key": "Content-Type", "value": "application/json"}],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"admin@example.com\",\n  \"matKhau\": \"123456\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/auth/login",
          "host": ["{{base_url}}"],
          "path": ["api", "auth", "login"]
        }
      },
      "response": []
    },
    {
      "name": "2. Upload Avatar (v·ªõi Sharp resize)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('‚úÖ Upload th√†nh c√¥ng', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    const jsonData = pm.response.json();",
              "    ",
              "    pm.test('‚úÖ C√≥ URL avatar', () => {",
              "        pm.expect(jsonData.avatar).to.be.a('string');",
              "        pm.expect(jsonData.avatar).to.include('cloudinary');",
              "    });",
              "    ",
              "    pm.test('‚úÖ C√≥ metadata', () => {",
              "        pm.expect(jsonData.metadata).to.be.an('object');",
              "        pm.expect(jsonData.metadata.original).to.be.an('object');",
              "        pm.expect(jsonData.metadata.resized).to.be.an('object');",
              "        pm.expect(jsonData.metadata.cloudinary).to.be.an('object');",
              "    });",
              "    ",
              "    pm.test('‚úÖ ·∫¢nh ƒë√£ ƒë∆∞·ª£c resize v·ªÅ 400x400', () => {",
              "        pm.expect(jsonData.metadata.resized.width).to.equal(400);",
              "        pm.expect(jsonData.metadata.resized.height).to.equal(400);",
              "    });",
              "    ",
              "    console.log('üì∏ ·∫¢nh g·ªëc:', jsonData.metadata.original);",
              "    console.log('‚úÖ ·∫¢nh ƒë√£ resize:', jsonData.metadata.resized);",
              "    console.log('‚òÅÔ∏è  Cloudinary:', jsonData.metadata.cloudinary.url);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Authorization", "value": "Bearer {{accessToken}}"}
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "avatar",
              "type": "file",
              "src": "",
              "description": "Ch·ªçn file ·∫£nh ƒë·ªÉ upload (JPG, PNG, GIF, WEBP)"
            }
          ]
        },
        "url": {
          "raw": "{{base_url}}/api/upload/avatar",
          "host": ["{{base_url}}"],
          "path": ["api", "upload", "avatar"]
        },
        "description": "Upload avatar v·ªõi Sharp resize t·ª± ƒë·ªông v·ªÅ 400x400px"
      },
      "response": []
    },
    {
      "name": "3. Upload Avatar Multiple Sizes",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('‚úÖ Upload multiple sizes th√†nh c√¥ng', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    const jsonData = pm.response.json();",
              "    ",
              "    pm.test('‚úÖ C√≥ 3 k√≠ch th∆∞·ªõc', () => {",
              "        pm.expect(jsonData.avatars).to.be.an('array');",
              "        pm.expect(jsonData.avatars).to.have.lengthOf(3);",
              "    });",
              "    ",
              "    pm.test('‚úÖ C√≥ thumbnail, medium, large', () => {",
              "        const sizes = jsonData.avatars.map(a => a.size);",
              "        pm.expect(sizes).to.include('thumbnail');",
              "        pm.expect(sizes).to.include('medium');",
              "        pm.expect(sizes).to.include('large');",
              "    });",
              "    ",
              "    console.log('üì∏ Avatars:', jsonData.avatars);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Authorization", "value": "Bearer {{accessToken}}"}
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "avatar",
              "type": "file",
              "src": "",
              "description": "Ch·ªçn file ·∫£nh"
            }
          ]
        },
        "url": {
          "raw": "{{base_url}}/api/upload/avatar-multiple",
          "host": ["{{base_url}}"],
          "path": ["api", "upload", "avatar-multiple"]
        },
        "description": "Upload avatar v·ªõi 3 k√≠ch th∆∞·ªõc: thumbnail (100x100), medium (400x400), large (800x800)"
      },
      "response": []
    },
    {
      "name": "4. L·∫•y th√¥ng tin profile (ki·ªÉm tra avatar)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('‚úÖ L·∫•y profile th√†nh c√¥ng', () => {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    const jsonData = pm.response.json();",
              "    ",
              "    pm.test('‚úÖ C√≥ avatar URL', () => {",
              "        pm.expect(jsonData.nguoiDung.avatar).to.be.a('string');",
              "    });",
              "    ",
              "    console.log('üë§ Avatar URL:', jsonData.nguoiDung.avatar);",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {"key": "Authorization", "value": "Bearer {{accessToken}}"}
        ],
        "url": {
          "raw": "{{base_url}}/api/profile",
          "host": ["{{base_url}}"],
          "path": ["api", "profile"]
        },
        "description": "Ki·ªÉm tra avatar ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t trong profile"
      },
      "response": []
    },
    {
      "name": "5. Upload file kh√¥ng h·ª£p l·ªá (400)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('‚úÖ B·ªã ch·∫∑n (400)', () => {",
              "    pm.response.to.have.status(400);",
              "});",
              "",
              "const jsonData = pm.response.json();",
              "pm.test('‚úÖ C√≥ th√¥ng b√°o l·ªói', () => {",
              "    pm.expect(jsonData.thongBao).to.be.a('string');",
              "});",
              "",
              "console.log('L·ªói (Expected):', jsonData.thongBao);"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {"key": "Authorization", "value": "Bearer {{accessToken}}"}
        ],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "avatar",
              "type": "file",
              "src": "",
              "description": "Ch·ªçn file kh√¥ng ph·∫£i ·∫£nh (PDF, TXT, etc) ƒë·ªÉ test validation"
            }
          ]
        },
        "url": {
          "raw": "{{base_url}}/api/upload/avatar",
          "host": ["{{base_url}}"],
          "path": ["api", "upload", "avatar"]
        },
        "description": "Test upload file kh√¥ng h·ª£p l·ªá (kh√¥ng ph·∫£i ·∫£nh)"
      },
      "response": []
    },
    {
      "name": "6. Upload kh√¥ng c√≥ token (401)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('‚úÖ B·ªã ch·∫∑n (401)', () => {",
              "    pm.response.to.have.status(401);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [],
        "body": {
          "mode": "formdata",
          "formdata": [
            {
              "key": "avatar",
              "type": "file",
              "src": ""
            }
          ]
        },
        "url": {
          "raw": "{{base_url}}/api/upload/avatar",
          "host": ["{{base_url}}"],
          "path": ["api", "upload", "avatar"]
        },
        "description": "Test upload kh√¥ng c√≥ token x√°c th·ª±c"
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    }
  ]
}

